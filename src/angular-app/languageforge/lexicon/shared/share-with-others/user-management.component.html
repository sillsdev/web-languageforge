<invite-member-form style="max-width: 30em;" on-send-email-invite="$ctrl.onSendEmailInvite($event)"
                    reusable-invite-link-user="$ctrl.reusableInviteLinkUser"></invite-member-form>

<div id="who-has-access" style="max-width: 30em;">
  <div class="row" style="position: relative;">
    <div class="col-6">
      <b style="position: absolute; bottom: 0;">Who has access</b>
    </div>
    <div class="col-6">
      <div class="float-right" style="position: relative;">
        <input class="form-control" type="text" data-ng-model="$ctrl.userFilter" placeholder="Filter Members">
        <a class="clear-search-button" data-ng-show="$ctrl.userFilter != ''" title="Clear Filter" data-ng-click="$ctrl.userFilter = ''"><i class="fa fa-times" style="color:gray"></i></a>
      </div>
    </div>
  </div>

  <listview search="$ctrl.loadMemberData()" items="$ctrl.allMembers" items-filter="$ctrl.userFilter" visible-items="$ctrl.visibleMembers" select="">
    <ul class="list-group">
      <li class="list-group-item user-summary-item">
        <div>
          <img src="/Site/views/shared/image/globe.png" class="rounded-circle" id="smallAvatarURL"/>
        </div>
        <div style="flex-grow: 1;">
          <span ng-class="{'text-muted': $ctrl.specialPermissionTargets.anonymousUser.role === 'disabled'}">Anyone</span><br>
          <div style="display: flex; flex-direction: row;">
            <span ng-class="{'text-muted': $ctrl.specialPermissionTargets.anonymousUser.role === 'disabled'}">via</span>
            <input ng-if="$ctrl.specialPermissionTargets.anonymousUser.role === 'disabled'" type="text" disabled
                   class="form-control" value="{{$ctrl.projectUrl}}" ng-readonly="true">
            <input ng-if="$ctrl.specialPermissionTargets.anonymousUser.role !== 'disabled'" type="text"
                   class="form-control" value="{{$ctrl.projectUrl}}" ng-readonly="true" onfocus="this.select();">
          </div>
        </div>
        <permissions-dropdown allow-disable="true" target="$ctrl.anonymousUser" initial="'disabled'"
                              on-permission-changed=$ctrl.onSpecialPermissionChanged($event) class="sm-no-margin"></permissions-dropdown>
        <div class="delete-member d-none d-md-block"></div>
      </li>

      <li class="list-group-item user-summary-item" data-ng-repeat="user in $ctrl.visibleMembers">
        <div>
          <img src="{{$ctrl.getAvatarUrl(user.avatar_ref)}}" class="rounded-circle" id="smallAvatarURL" />
        </div>
        <div style="flex-grow: 1;" ng-class="{'text-muted': user.isInvitee}">
          <span ng-if="user.name">{{user.name}}<span ng-if="$ctrl.userIsCurrentUser(user)"> (you)</span><br></span>
          <span ng-if="!user.isInvitee" class='username-email'>{{user.username}}</span>
          <span ng-if="user.isInvitee" class="invited-user username-email">{{user.username || user.email}} <br class="d-md-none">[invited]</span>
          <span ng-if="$ctrl.userIsCurrentUser(user) && !user.name"> (you)</span>
        </div>
        <div class="sm-no-margin">
          <div ng-if="$ctrl.userIsOwner(user)" class="permissions-indicator text-muted">owner</div>
          <permissions-dropdown ng-if="!$ctrl.userIsOwner(user)" target="user"
                                on-permission-changed="$ctrl.onUserPermissionChanged($event)"
                                on-delete-target="$ctrl.onDeleteTarget($event)"
                                allow-delete="true"
                                initial="user.role"></permissions-dropdown>
        </div>
        <i class="fa fa-times delete-member d-none d-md-block" ng-click="$ctrl.removeUser(user);"
            ng-if="!$ctrl.userIsOwner(user) && !$ctrl.userIsCurrentUser(user)"></i>
        <div class="delete-member d-none d-md-block" ng-if="$ctrl.userIsOwner(user) || $ctrl.userIsCurrentUser(user)"></div>
      </li>
      <div class="scroll-gradient" id="scroll-gradient-lower"></div>
    </ul>
  </listview>
</div>
